/******************************************************************************/
/***          Generated by IBExpert 2012.02.21 24/11/2014 12:47:13          ***/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES NONE;

SET CLIENTLIB 'C:\Windows\System32\fbclient.dll';

CREATE DATABASE 'C:\Projetos\MHZ\Leitura de Guias\BD\mhz.FDB'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 4096
DEFAULT CHARACTER SET NONE COLLATION NONE;



/******************************************************************************/
/***                                Domains                                 ***/
/******************************************************************************/

CREATE DOMAIN DO_BIGINT AS
BIGINT;

CREATE DOMAIN DO_BLOB_FILE AS
BLOB SUB_TYPE 0 SEGMENT SIZE 80;

CREATE DOMAIN DO_BLOB_IMAGENS AS
BLOB SUB_TYPE 0 SEGMENT SIZE 4096;

CREATE DOMAIN DO_BLOB_TEXT AS
BLOB SUB_TYPE 1 SEGMENT SIZE 80;

CREATE DOMAIN DO_BOOLEAN AS
VARCHAR(5)
DEFAULT 'FALSE';

CREATE DOMAIN DO_CHAR1 AS
CHAR(1);

CREATE DOMAIN DO_CHAR_1 AS
CHAR(1);

CREATE DOMAIN DO_CHAVEPRIMARIA AS
INTEGER
NOT NULL;

CREATE DOMAIN DO_DATA_HORA AS
TIMESTAMP;

CREATE DOMAIN DO_DATE AS
DATE;

CREATE DOMAIN DO_DOUBLE_PRE AS
DOUBLE PRECISION;

CREATE DOMAIN DO_DO_FLOAT AS
FLOAT;

CREATE DOMAIN DO_INTEIRO AS
INTEGER;

CREATE DOMAIN DO_SMALLINT AS
SMALLINT;

CREATE DOMAIN DO_TIME AS
TIME;

CREATE DOMAIN DO_VARCHAR_05 AS
VARCHAR(5);

CREATE DOMAIN DO_VARCHAR_10 AS
VARCHAR(10);

CREATE DOMAIN DO_VARCHAR_100 AS
VARCHAR(100);

CREATE DOMAIN DO_VARCHAR_120 AS
VARCHAR(120);

CREATE DOMAIN DO_VARCHAR_150 AS
VARCHAR(150);

CREATE DOMAIN DO_VARCHAR_2 AS
VARCHAR(2);

CREATE DOMAIN DO_VARCHAR_20 AS
VARCHAR(20);

CREATE DOMAIN DO_VARCHAR_200 AS
VARCHAR(200);

CREATE DOMAIN DO_VARCHAR_250 AS
VARCHAR(250);

CREATE DOMAIN DO_VARCHAR_255 AS
VARCHAR(500);

CREATE DOMAIN DO_VARCHAR_30 AS
VARCHAR(30);

CREATE DOMAIN DO_VARCHAR_40 AS
VARCHAR(40);

CREATE DOMAIN DO_VARCHAR_50 AS
VARCHAR(50);

CREATE DOMAIN DO_VARCHAR_60 AS
VARCHAR(60);

CREATE DOMAIN DO_VARCHAR_80 AS
VARCHAR(80);



/******************************************************************************/
/***                               Generators                               ***/
/******************************************************************************/

CREATE GENERATOR GEN_CLIENTE;
SET GENERATOR GEN_CLIENTE TO 4;

CREATE GENERATOR GEN_GUIAS_CABECALHO;
SET GENERATOR GEN_GUIAS_CABECALHO TO 433;

CREATE GENERATOR GEN_GUIAS_DETALHE;
SET GENERATOR GEN_GUIAS_DETALHE TO 41191;

CREATE GENERATOR GEN_GUIAS_GRUPO_LOTE;
SET GENERATOR GEN_GUIAS_GRUPO_LOTE TO 175;

CREATE GENERATOR GEN_IMPORTACAO_GUIAS_CABECALHO;
SET GENERATOR GEN_IMPORTACAO_GUIAS_CABECALHO TO 17;

CREATE GENERATOR GEN_LEITURA_STATUS;
SET GENERATOR GEN_LEITURA_STATUS TO 3;

CREATE GENERATOR GEN_TIPO_SERVICO;
SET GENERATOR GEN_TIPO_SERVICO TO 7;

CREATE GENERATOR GEN_USUARIO;
SET GENERATOR GEN_USUARIO TO 15;



/******************************************************************************/
/***                                 Tables                                 ***/
/******************************************************************************/



CREATE TABLE CLIENTES (
    ID_CLIENTE  INTEGER NOT NULL,
    CLIENTE     DO_VARCHAR_50,
    EMAIL       DO_VARCHAR_50
);

CREATE TABLE GUIAS_CABECALHO (
    ID_GUIAS_CABECALHO       DO_CHAVEPRIMARIA NOT NULL,
    ID_GUIAS_GRUPO_LOTE      DO_CHAVEPRIMARIA NOT NULL,
    TIPO_TRANSACAO           DO_VARCHAR_50,
    SEQUENCIAL_TRANSACAO     DO_INTEIRO,
    DATA_REGISTRO_TRANSACAO  DO_DATE,
    HORA_REGISTRO_TRANSACAO  DO_TIME,
    REGISTRO_ANS             DO_VARCHAR_20,
    VERSAO_PADRAO            DO_VARCHAR_20,
    FINALIZADO               DO_BOOLEAN,
    CANCELADO                DO_BOOLEAN
);

CREATE TABLE GUIAS_DETALHE (
    ID_GUIAS_DETALHE        DO_CHAVEPRIMARIA NOT NULL,
    ID_GUIAS_CABECALHO      DO_INTEIRO NOT NULL,
    REGISTRO_ANS            DO_VARCHAR_50,
    DATA_EMISSAO_GUIA       DO_DATE,
    NUMERO_GUIA_PRESTADOR   DO_INTEIRO,
    DADOS_AUTORIZACAO       DO_VARCHAR_50,
    NUMERO_CARTEIRA         DO_INTEIRO,
    NOME_BENEFICIARIO       DO_VARCHAR_200,
    NOME_PLANO              DO_VARCHAR_50,
    NOME_CONTRATADO1        DO_VARCHAR_200,
    NOME_PROFISSIONAL       DO_VARCHAR_200,
    SIGLA_CONSELHO          DO_VARCHAR_30,
    NUMERO_CONSELHO         DO_VARCHAR_30,
    UF_CONSELHO             DO_VARCHAR_05,
    NOME_CONTRATADO2        DO_VARCHAR_200,
    CARATER_ATENDIMENTO     DO_VARCHAR_20,
    TIPO_SAIDA              DO_VARCHAR_10,
    TIPO_ATENDIMENTO        DO_VARCHAR_10,
    CODIGO                  DO_VARCHAR_20,
    TIPO_TABELA             DO_VARCHAR_10,
    DESCRICAO               DO_VARCHAR_250,
    DATA                    DO_DATE,
    QUANTIDADE_REALIZADA    DO_INTEIRO,
    VALOR                   DO_DOUBLE_PRE,
    VALORTOTAL_1            DO_DOUBLE_PRE,
    VALORTOTAL_2            DO_DOUBLE_PRE,
    LIDA                    DO_BOOLEAN,
    RETIRADA                DO_BOOLEAN,
    CADASTRADA_MANUALMENTE  DO_BOOLEAN,
    GUIA_EM_BRANCO          DO_BOOLEAN,
    GUIA_COM_DESCONTO       DO_BOOLEAN,
    DATA_LEITURA            DO_DATE,
    HORA_LEITURA            DO_TIME,
    ID_USUARIO_LEITURA      DO_INTEIRO,
    ID_LEITURA_STATUS       DO_INTEIRO
);

CREATE TABLE GUIAS_GRUPO_LOTE (
    ID_GUIAS_GRUPO_LOTE  DO_CHAVEPRIMARIA NOT NULL,
    ID_USUARIO           DO_CHAVEPRIMARIA,
    DT_IMPORTACAO        DO_DATE,
    HR_IMPORTACAO        DO_TIME,
    ID_TIPO_SERVICO      DO_CHAVEPRIMARIA
);

CREATE TABLE LEITURA_STATUS (
    ID_LEITURA_STATUS  DO_CHAVEPRIMARIA NOT NULL,
    DESCRICAO          DO_VARCHAR_50
);

CREATE TABLE TIPO_SERVICO (
    ID_TIPO_SERVICO  DO_CHAVEPRIMARIA DEFAULT 1 NOT NULL,
    DESCRICAO        DO_VARCHAR_50
);

CREATE TABLE USUARIO (
    ID_USUARIO     INTEGER NOT NULL,
    LOGIN          DO_VARCHAR_20 NOT NULL,
    NOME           DO_VARCHAR_50,
    SENHA          DO_VARCHAR_20,
    ADMINISTRADOR  DO_BOOLEAN DEFAULT 'N',
    ATIVO          DO_BOOLEAN DEFAULT 'S' NOT NULL
);



/******************************************************************************/
/***                              Primary Keys                              ***/
/******************************************************************************/

ALTER TABLE CLIENTES ADD CONSTRAINT PK_CLIENTES PRIMARY KEY (ID_CLIENTE);
ALTER TABLE GUIAS_CABECALHO ADD CONSTRAINT PK_GUIAS_CABECALHO PRIMARY KEY (ID_GUIAS_CABECALHO);
ALTER TABLE GUIAS_DETALHE ADD CONSTRAINT PK_GUIAS_DETALHE PRIMARY KEY (ID_GUIAS_DETALHE);
ALTER TABLE GUIAS_GRUPO_LOTE ADD CONSTRAINT PK_GUIAS_GRUPO_LOTE PRIMARY KEY (ID_GUIAS_GRUPO_LOTE);
ALTER TABLE LEITURA_STATUS ADD CONSTRAINT PK_LEITURA_STATUS PRIMARY KEY (ID_LEITURA_STATUS);
ALTER TABLE TIPO_SERVICO ADD CONSTRAINT PK_TIPO_SERVICO PRIMARY KEY (ID_TIPO_SERVICO);
ALTER TABLE USUARIO ADD CONSTRAINT PK_USUARIO PRIMARY KEY (ID_USUARIO);


/******************************************************************************/
/***                              Foreign Keys                              ***/
/******************************************************************************/

ALTER TABLE GUIAS_CABECALHO ADD CONSTRAINT FK_GUIAS_CAB_ID_GUIAS_GRUPO_LOT FOREIGN KEY (ID_GUIAS_GRUPO_LOTE) REFERENCES GUIAS_GRUPO_LOTE (ID_GUIAS_GRUPO_LOTE);
ALTER TABLE GUIAS_DETALHE ADD CONSTRAINT FK_GUIAS_DETALHE_GUIAS_CABEC FOREIGN KEY (ID_GUIAS_CABECALHO) REFERENCES GUIAS_CABECALHO (ID_GUIAS_CABECALHO);
ALTER TABLE GUIAS_DETALHE ADD CONSTRAINT FK_GUIAS_DETALHE_ID_STATUS FOREIGN KEY (ID_LEITURA_STATUS) REFERENCES LEITURA_STATUS (ID_LEITURA_STATUS);
ALTER TABLE GUIAS_DETALHE ADD CONSTRAINT FK_GUIAS_DETALHE_ID_USUARIO_LEI FOREIGN KEY (ID_USUARIO_LEITURA) REFERENCES USUARIO (ID_USUARIO);
ALTER TABLE GUIAS_GRUPO_LOTE ADD CONSTRAINT FK_GUIAS_GRUPO_LOTE_ID_TIPO_SER FOREIGN KEY (ID_TIPO_SERVICO) REFERENCES TIPO_SERVICO (ID_TIPO_SERVICO);


/******************************************************************************/
/***                                Indices                                 ***/
/******************************************************************************/

CREATE INDEX IDX_GUIAS_CABECALHO_CANCELADO ON GUIAS_CABECALHO (CANCELADO);
CREATE INDEX IDX_GUIAS_CABECALHO_FINALIZADO ON GUIAS_CABECALHO (FINALIZADO);
CREATE INDEX IDX_GUIAS_CAB_DATA ON GUIAS_CABECALHO (DATA_REGISTRO_TRANSACAO);
CREATE INDEX IDX_GUIAS_CAB_SEQ ON GUIAS_CABECALHO (SEQUENCIAL_TRANSACAO);
CREATE INDEX IDX_GUIAS_DETALHE_DATA ON GUIAS_DETALHE (DATA);
CREATE INDEX IDX_GUIAS_DETALHE_DATA_EMISSAO ON GUIAS_DETALHE (DATA_EMISSAO_GUIA);
CREATE INDEX IDX_GUIAS_DETALHE_DATA_LEITURA ON GUIAS_DETALHE (DATA_LEITURA);
CREATE INDEX IDX_GUIAS_DETALHE_LIDA ON GUIAS_DETALHE (LIDA);
CREATE INDEX IDX_GUIAS_DETALHE_NUMERO_CART ON GUIAS_DETALHE (NUMERO_CARTEIRA);
CREATE INDEX IDX_GUIAS_DETALHE_NUM_GUIA_PRES ON GUIAS_DETALHE (NUMERO_GUIA_PRESTADOR);
